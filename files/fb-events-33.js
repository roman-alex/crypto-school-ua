window.FbEvents={currency:"USD",delivery_category:null,content_category:null,partner_id:null,logEvents:[],stack:[],debug:false,sending:false,data:{},AddToWishlist:function(products=[],content_name=null,order_id=null){this.data={event_name:"AddToWishlist",custom_data:{content_type:products&&products.length>1?"product_group":"product",value:0,contents:[],content_ids:[],num_items:0,currency:this.currency}};if(order_id)this.data.custom_data.order_id=order_id;if(content_name)this.data.custom_data.content_name=content_name;products&&products.length&&this.mapProduct(products);this.send()},ViewContent:function(content_id,item_price,content_name="",quantity=1){this.data={event_name:"ViewContent",custom_data:{currency:this.currency}};if(content_id&&item_price){this.data.custom_data.value=item_price*quantity;this.data.custom_data.content_ids=[{id:content_id,quantity:quantity,item_price:item_price}];this.data.custom_data.content_type="product";this.data.custom_data.content_ids=[content_id]}if(content_name)this.data.custom_data.content_name=content_name;this.send()},AddToCart:function(content_id,item_price,quantity=1,content_name=null){this.data={event_name:"AddToCart",custom_data:{content_type:"product",value:quantity*item_price,contents:[{id:content_id,quantity:quantity,item_price:item_price}],content_ids:[content_id],currency:this.currency}};if(content_name)this.data.custom_data.content_name=content_name;this.send()},InitiateCheckout:function(products=[]){this.data={event_name:"InitiateCheckout",custom_data:{content_type:products&&products.length>1?"product_group":"product",value:0,contents:[],content_ids:[],num_items:0,currency:this.currency}};products&&products.length&&this.mapProduct(products);this.send()},Purchase:function(products=[],order_id=null){this.data={event_name:"Purchase",custom_data:{content_type:products.length>1?"product_group":"product",value:0,contents:[],content_ids:[],currency:this.currency}};if(order_id)this.data.custom_data.order_id=order_id;products&&products.length&&this.mapProduct(products);this.send()},Lead:function(products=[],order_id=null,value=null,content_name=null){if(products&&products.length){this.data={event_name:"Lead",custom_data:{content_type:products.length>1?"product_group":"product",value:0,contents:[],content_ids:[],currency:this.currency}}}else{this.data={event_name:"Lead",custom_data:{}};this.content_category&&(this.data.custom_data.content_category=this.content_category);if(value){this.data.custom_data.value=value;this.data.custom_data.currency=this.currency}}if(order_id)this.data.custom_data.order_id=order_id;if(content_name)this.data.custom_data.content_name=content_name;products&&products.length&&this.mapProduct(products);this.send()},Contact:function(){this.data={event_name:"Contact"};this.send()},SubmitApplication:function(){this.data={event_name:"SubmitApplication"};this.send()},Subscribe:function(value=0,predicted_ltv=1){this.data={event_name:"Subscribe",custom_data:{value:value,predicted_ltv:predicted_ltv,currency:this.currency}};this.send()},mapProduct:function(products=[]){products&&products.length&&products.map(e=>{if(e.id){this.data.custom_data.content_ids.push(e.id);if(this.data.custom_data.num_items)this.data.custom_data.num_items+=e.quantity||1;let data={id:e.id,quantity:e.quantity||1,item_price:e.item_price||0};if(this.delivery_category)data.custom_data.delivery_category=this.delivery_category;this.data.custom_data.contents.push(data);!!e.item_price&&(this.data.custom_data.value+=e.item_price*(e.quantity||1))}else console.log("id is a required")})},CompleteRegistration:function(content_name=null,value=null,status=true){this.data={event_name:"CompleteRegistration",custom_data:{status:status,currency:this.currency}};if(content_name)this.data.custom_data.content_name=content_name;if(value)this.data.custom_data.value=value;this.send()},CustomEvent:function(eventName,params=null){this.data={event_name:eventName,custom_data:{currency:this.currency}};if(params&&typeof params!=="object")throw'CustomEvent: second parameter "params" is not object!';if(params)this.data.custom_data=params;this.send()},triggerSend:function(){try{localStorage.setItem("FbEventsJSON",JSON.stringify(window.FbEvents.logEvents))}catch(e){}let item=this.stack[0];if(item&&!this.sending){this.sending=true;this.debug&&console.log(item);let formData=this.jsonToFormData(item);fetch("https://api.median-ads.com/partners/fbcapi",{body:formData,method:"POST",mode:"cors"}).then(e=>e.json()).then(e=>{if(e){FbEvents.setCookie(e.id);e.fbp&&FbEvents.setCookie(e.fbp,"_fbp")}item.status="OK";window.FbEvents.logEvents.push(item);FbEvents.stack.shift();FbEvents.sending=false;FbEvents.triggerSend()}).catch(()=>{item.status="Error";window.FbEvents.logEvents.push(item);FbEvents.stack.shift();FbEvents.sending=false;FbEvents.triggerSend()})}},send:function(){if(!this.partner_id)return;this.data.partner_id=this.partner_id;this.data.event_source_url=location.href;this.data.id=this.getCookie();this.content_category&&this.data.custom_data&&(this.data.custom_data.content_category=this.content_category);this.data.fbclid=this.getQueryParam()||this.getCookie("fbclid");this.data.user_data={client_user_agent:navigator.userAgent,fbc:this.getCookie("_fbc"),fbp:this.getCookie("_fbp")};this.stack.push(this.data);this.data={};this.triggerSend()},getCookie:function(name="fb_partners_user_id"){let match=document.cookie.match(new RegExp("(^| )"+name+"=([^;]+)"));if(match)return match[2]},setCookie:function(value,name="fb_partners_user_id"){let date=new Date;date.setTime(date.getTime()+2592e6);let expires="; expires="+date.toUTCString();document.cookie=name+"="+(value||"")+expires+"; path=/"},getQueryParam:function(name="fbclid"){name=name.replace(/[\[\]]/g,"\\$&");let regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(location.search);if(!results||!results[2])return"";return decodeURIComponent(results[2].replace(/\+/g," "))},buildFormData:function(formData,data,parentKey){if(data&&typeof data==="object"&&!(data instanceof Date)&&!(data instanceof File)){Object.keys(data).forEach(key=>{this.buildFormData(formData,data[key],parentKey?`${parentKey}[${key}]`:key)})}else{const value=data==null?"":data;formData.append(parentKey,value)}},jsonToFormData:function(data){const formData=new FormData;this.buildFormData(formData,data);return formData}};try{let utms=["utm_source","utm_term","utm_campaign","utm_content","utm_medium","fbclid"];utms.forEach(function(e){let utm=FbEvents.getQueryParam(e);if(utm)FbEvents.setCookie(utm,e)});localStorage.removeItem("FbEventsJSON")}catch(e){}
FbEvents.partner_id = 33
FbEvents.currency = "EUR"
function setCookieEmail(value) {
    let date = new Date()
    date.setTime(date.getTime() + 2592000000)
    let expires = "; expires=" + date.toUTCString()
    document.cookie = "form_email=" + (value || "") + expires + "; path=/"
}

function t678_onSuccess(form){
    let url = form.data('success-url'),
        email = form.find('input[name="Email"]').val()
    setCookieEmail(email)
    FbEvents.CompleteRegistration(document.title)
    $.post('https://api.median-ads.com/cryptology/mailchimp', form.serialize(), function (json){
        console.log(json)
    })
    if (url)
        setTimeout(function (){
            location.href = url
        }, 1000)
}
$('a[href="https://t.me/Cryptology_info_bot"]').click(function (e){
    let match = document.cookie.match(new RegExp('(^| )form_email=([^;]+)'))
    if (match)
        $.post('https://api.median-ads.com/cryptology/mailchimp', {Email: match[2], groups: ['fb8fb99c74']})
    FbEvents.Subscribe()
})
